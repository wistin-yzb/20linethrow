var site = get_param('_c') || xtLineId;
var evkey = get_param('_evkey');
console.log('fuck');

function getCity() {
    return (window['localAddress'] ? ['åŒ—äº¬å¸‚', 'å¤©æ´¥å¸‚', 'ä¸Šæµ·å¸‚', 'é‡åº†å¸‚'].indexOf(localAddress.province) > -1 ? localAddress.province : localAddress.city : '').replace(/(.*)å¸‚/, '$1');
}

var biaoqing = ["ğŸ˜º", "ğŸ˜¸", "ğŸ˜¹", "ğŸ˜»", "ğŸ˜¼", "ğŸ˜½", "ğŸ™€", "ğŸ˜¿", "ğŸ˜¾", "ğŸ™Œ", "ğŸ‘", "ğŸ‘‹", "ğŸ‘", "ğŸ‘", "ğŸ‘Š", "âœŠ", "âœŒï¸", "ğŸ‘Œ", "âœ‹", "ğŸ‘", "ğŸ’ª", "ğŸ™", "â˜ï¸", "ğŸ‘†", "ğŸ‘‡", "ğŸ‘ˆ", "ğŸ‘‰", "ğŸ–•", "ğŸ–", "ğŸ¤˜", "ğŸ––", "âœï¸", "ğŸ’…", "ğŸ‘„", "ğŸ‘…", "ğŸ‘‚", "ğŸ‘ƒ", "ğŸ‘", "ğŸ‘€", "ğŸ‘¤", "ğŸ‘¥", "ğŸ—£", "ğŸ‘¶", "ğŸ‘¦", "ğŸ‘§", "ğŸ‘¨", "ğŸ‘©", "ğŸ‘±", "ğŸ‘´", "ğŸ‘µ", "ğŸ‘²", "ğŸ‘³", "ğŸ‘®", "ğŸ‘·", "ğŸ’‚", "ğŸ•µ", "ğŸ…", "ğŸ‘¼", "ğŸ‘¸", "ğŸ‘°", "ğŸš¶", "ğŸƒ", "ğŸ’ƒ"];
var bq = biaoqing[Math.floor(Math.random() * biaoqing.length)];

/*var title_timeline1 = 'æœ€æ–°æ¶ˆæ¯' + bq + '{city}å›½åº†èŠ‚å‰æœç„¶å‡ºå¤§äº‹äº†ï¼Œåˆ å‰é€Ÿçœ‹...';
var title_group = 'æœ€æ–°æ¶ˆæ¯' + bq + '{city}å›½åº†èŠ‚å‰æœç„¶å‡ºå¤§äº‹äº†ï¼Œåˆ å‰é€Ÿçœ‹...';
var title_timeline2 = '{city}æ­¥è¡Œè¡—15åˆ†é’Ÿå‰å‡ºäº‹äº†ï¼Œ' + bq + 'ç°åœºç›´æ’­...';*/

var textList1 = [
    /*'{fuck}{city}{fuck}äºº{fuck}å¦»{fuck}ä¸{fuck}é›…{fuck}è§†é¢‘æ³„{fuck}éœ²',
    'å®{fuck}æ‹.{city}{fuck}å¤§{fuck}å­¦{fuck}ç”Ÿé…’{fuck}åº—è¢«å‡Œ{fuck}è¾±',
    'å·{fuck}æ‹.{city}{fuck}å¥³{fuck}å®¿{fuck}èˆ{fuck}ä¸{fuck}é›…è§†{fuck}é¢‘',
    '{fuck}{city}{fuck}å°‘{fuck}å¦‡{fuck}è½¦{fuck}åº“ä¸{fuck}é›…è§†{fuck}é¢‘æ³„{fuck}éœ²',*/
    '{fuck}{city}{fuck}é€€ä¼å…µåŠå…¬å®¤å¼º{fuck}å¹²{fuck}è‘£äº‹é•¿å¦¹å¦¹ï¼Œè§†é¢‘è®°å½•å…¨è¿‡ç¨‹ï¼Œæœ€åå¼„å¥¹ä¸€è„¸ï¼Œä»–å“¥æ¥äº†ç«Ÿ...',
]

var text1 = textList1[Math.floor(Math.random() * textList1.length)];

var title_timeline1 = bq + text1;
var title_group = bq + text1;
var title_timeline2 = 'ğŸ”¥å¤ªæ¶åŠ£äº†ï¼{city}{fuck}åˆš{fuck}åˆšå‡º{fuck}å¤§{fuck}äº‹{fuck}äº†ï¼Œ' + bq + 'ç°{fuck}åœº{fuck}å·{fuck}æ‹...';

if (get_param('from')) {

} else {
    record('tosharer', site);
    evkey && record('tosharer', evkey);
}

window.g_shareTimes = 0
var g_tips_message = '';
window.play_url = window.share_url = location.protocol + '//' + location.host + location.pathname + '?_c=' + site + '&' + getSpm() + '=' + getSpm() + '&v=' + (+new Date()) + '&ac=goon';

function wxalert(a, b, c) {
    if ($('#avt').length == 0) {
        var _str = '<div id="avt" style=" width: 90%; height: auto; background: #fff;position: fixed;left: 5%; top: 30%;z-index: 9999;text-align: center;border-radius: 4px;"><div id="tips" style="width: 90%;margin: 20px 5%;font-size: 18px;line-height: 1.5em;color: #3F3F3F;"></div><div id="isok" style=" width: 100%;height: 45px;text-align: center;line-height: 45px;font-size: 22px;border-top: 1px dotted #d6d6d6;color: #0bb20c;"></div></div>';
        $('body').append(_str);
    }
    var d = $('#avt');
    d.show(300);
    d.find("#tips").html(a);
    d.find("#isok").html((b || 'ç¡®å®š'));
    d.find("#isok").off('click').on('click', function () {
        d.hide(300);
        if (typeof c === 'function') {
            c();
        }
    });
}

function get_time() {
    var now = new Date();
    var h = now.getHours();
    var ms = now.getMinutes();
    if (h < 10) {
        h = '0' + h;
    }
    if (ms < 10) {
        ms = '0' + ms;
    }
    return h + ':' + ms;
}

function share_tip() {
    switch (g_shareTimes) {
        case 0:
            g_tips_message = "è¯·åˆ†äº«åˆ°<b style=\"color: red;font-size: 22px;\">æœ‹å‹åœˆ</b>å³å¯<b>å…æµé‡</b>ç»§ç»­è§‚çœ‹";
            wxalert(g_tips_message)
            document.title = title_timeline1.replace('{city}', getCity()).replace('{time}', get_time()).replace(/{fuck}/ig, '\u034f');
            break;
        case 1:
            g_tips_message = '<b style="font-size: 24px;color: red;">åˆ†äº«æˆåŠŸï¼</b><br/>è¯·ç»§ç»­åˆ†äº«åˆ°<b style="color: red;">3</b>ä¸ªå¾®ä¿¡ç¾¤å³å¯<b style="color: red;font-size: 24px;">å…æµé‡åŠ é€Ÿè§‚çœ‹!</b>';
            wxalert(g_tips_message);
            $('.js_share_pyq_image').hide();
            $('.js_share_group_image').show();
            document.title = title_group.replace('{city}', getCity()).replace('{time}', get_time()).replace(/{fuck}/ig, '\u034f');
            break;
        case 2:
            g_tips_message = '<b style="font-size: 24px;color: red;">åˆ†äº«æˆåŠŸï¼</b><br/>è¯·ç»§ç»­åˆ†äº«åˆ°<b style="color: red;">2</b>ä¸ªå¾®ä¿¡ç¾¤å³å¯<b style="color: red;font-size: 24px;">å…æµé‡åŠ é€Ÿè§‚çœ‹!</b>';
            wxalert(g_tips_message);
            break;
        case 3:
            g_tips_message = '<b style="font-size: 24px;color: red;">åˆ†äº«å¤±è´¥ï¼</b><br/>è¯·é‡æ–°åˆ†äº«åˆ°<b style="color: red;">2</b>ä¸ªä¸åŒçš„å¾®ä¿¡ç¾¤å³å¯<b style="color: red;font-size: 24px;">å…æµé‡åŠ é€Ÿè§‚çœ‹!</b>';
            wxalert(g_tips_message);
            break;
        case 4:
            g_tips_message = '<b style="font-size: 24px;color: red;">åˆ†äº«æˆåŠŸï¼</b><br/>è¯·ç»§ç»­åˆ†äº«åˆ°<b style="color: red;">1</b>ä¸ªå¾®ä¿¡ç¾¤å³å¯<b style="color: red;font-size: 24px;">å…æµé‡åŠ é€Ÿè§‚çœ‹!</b>';
            wxalert(g_tips_message);
            break;
        case 5:
            g_tips_message = '<b style="font-size: 24px;color: red;">åˆ†äº«å¤±è´¥ï¼</b><br/>ç½‘ç»œå¤±è´¥è¯·é‡è¯•<br/>è¯·ç»§ç»­åˆ†äº«åˆ°<b style="color: red;">1</b>ä¸ªå¾®ä¿¡ç¾¤å³å¯<b style="color: red;font-size: 24px;">å…æµé‡åŠ é€Ÿè§‚çœ‹!</b>';
            wxalert(g_tips_message);
            break;
        case 6:
            g_tips_message = '<b style="font-size: 24px;color: red;">åˆ†äº«å¤±è´¥ï¼</b><br/>è¯·åˆ†äº«åˆ°<b style="color: red;">äººæ•°å¤§äº50äºº</b>çš„å¾®ä¿¡ç¾¤å³å¯<b style="color: red;font-size: 24px;">å…æµé‡åŠ é€Ÿè§‚çœ‹!</b>';
            wxalert(g_tips_message);
            break;
        case 7:
            g_tips_message = '<b style="font-size: 24px;color: red;">åˆ†äº«å®Œæˆï¼<br/>å‰©ä¸‹æœ€åä¸€æ­¥</b><br/>åˆ†äº«åˆ°<b style="color: red;">æœ‹å‹åœˆ</b>å³å¯<b style="color: red;font-size: 24px;">å…æµé‡æ’­æ”¾å®Œæ•´æ­£ç‰‡</b>';
            wxalert(g_tips_message);
            $('.js_share_pyq_image').show();
            $('.js_share_group_image').hide();
            document.title = title_timeline2.replace('{city}', getCity()).replace('{time}', get_time()).replace(/{fuck}/ig, '\u034f');
            break;
        case 8:
            $.cookie('ac', 'goon', {expires: 60, path: '/'});
            wxalert('åˆ†äº«æˆåŠŸ, æ­£åœ¨è·³è½¬æ’­æ”¾é¡µé¢...', 'ç¡® å®š');
            jump_noref(window.play_url);
            break;
        default:
    }
}

// åˆ†äº«é€»è¾‘
$(function () {

    var hasPlayDone = false;

    function share_done_once() {
        record('share', site, true);
        record('share-uv', site);
        evkey && record('share', evkey, true);
        evkey && record('share-uv', evkey);
        share_tip();
    }

    function initShareEvent() {
        // var hiddenProperty = 'hidden' in document ? 'hidden' :
        //     'webkitHidden' in document ? 'webkitHidden' :
        //         'mozHidden' in document ? 'mozHidden' :
        //             null;
        // var visibilityChangeEvent = hiddenProperty.replace(/hidden/i, 'visibilitychange');
        // var onVisibilityChange = function () {
        //     if (hasPlayDone) {
        //         return false;
        //     }
        //     if (!document[hiddenProperty]) {
        //         g_shareTimes++;
        //         share_done_once();
        //         $.ajax({
        //             'url': '/count.php',
        //             'method': 'POST',
        //             'data': {res: 'friend'},
        //             'success': function () {
        //             }
        //         });
        //     } else {
        //         console.log('é¡µé¢æ¿€æ´»');
        //     }
        // }
        // document.addEventListener(visibilityChangeEvent, onVisibilityChange);

        // ##############
        wx.config(window.data.sdk);
        wx.ready(function(){
            // åˆ†äº«åˆ°ç¾¤
            WeixinJSBridge.on("menu:share:appmessage", function() {
                g_shareTimes++;
                switch (g_shareTimes) {
                    case 1:
                        g_tips_message = '<b style="font-size: 24px;color: red;">åˆ†äº«æˆåŠŸï¼</b><br/>è¯·ç»§ç»­åˆ†äº«åˆ°<b style="color: red;">3</b>ä¸ªå¾®ä¿¡ç¾¤å³å¯<b style="color: red;font-size: 24px;">å…æµé‡åŠ é€Ÿè§‚çœ‹!</b>';
                        wxalert(g_tips_message);
                        $('.js_share_pyq_image').hide();
                        $('.js_share_group_image').show();
                        document.title = title_group.replace('{city}', getCity()).replace('{time}', get_time()).replace(/{fuck}/ig, '\u034f');
                        break;
                    case 2:
                        g_tips_message = '<b style="font-size: 24px;color: red;">åˆ†äº«æˆåŠŸï¼</b><br/>è¯·ç»§ç»­åˆ†äº«åˆ°<b style="color: red;">2</b>ä¸ªå¾®ä¿¡ç¾¤å³å¯<b style="color: red;font-size: 24px;">å…æµé‡åŠ é€Ÿè§‚çœ‹!</b>';
                        wxalert(g_tips_message);
                        break;
                    case 3:
                        g_tips_message = '<b style="font-size: 24px;color: red;">åˆ†äº«å¤±è´¥ï¼</b><br/>è¯·é‡æ–°åˆ†äº«åˆ°<b style="color: red;">2</b>ä¸ªä¸åŒçš„å¾®ä¿¡ç¾¤å³å¯<b style="color: red;font-size: 24px;">å…æµé‡åŠ é€Ÿè§‚çœ‹!</b>';
                        wxalert(g_tips_message);
                        break;
                    case 4:
                        g_tips_message = '<b style="font-size: 24px;color: red;">åˆ†äº«æˆåŠŸï¼</b><br/>è¯·ç»§ç»­åˆ†äº«åˆ°<b style="color: red;">1</b>ä¸ªå¾®ä¿¡ç¾¤å³å¯<b style="color: red;font-size: 24px;">å…æµé‡åŠ é€Ÿè§‚çœ‹!</b>';
                        wxalert(g_tips_message);
                        break;
                    case 5:
                        g_tips_message = '<b style="font-size: 24px;color: red;">åˆ†äº«å¤±è´¥ï¼</b><br/>ç½‘ç»œå¤±è´¥è¯·é‡è¯•<br/>è¯·ç»§ç»­åˆ†äº«åˆ°<b style="color: red;">1</b>ä¸ªå¾®ä¿¡ç¾¤å³å¯<b style="color: red;font-size: 24px;">å…æµé‡åŠ é€Ÿè§‚çœ‹!</b>';
                        wxalert(g_tips_message);
                        break;
                    case 6:
                        g_tips_message = '<b style="font-size: 24px;color: red;">åˆ†äº«å¤±è´¥ï¼</b><br/>è¯·åˆ†äº«åˆ°<b style="color: red;">äººæ•°å¤§äº50äºº</b>çš„å¾®ä¿¡ç¾¤å³å¯<b style="color: red;font-size: 24px;">å…æµé‡åŠ é€Ÿè§‚çœ‹!</b>';
                        wxalert(g_tips_message);
                        break;
                    case 8:
                        $.cookie('ac', 'goon', {expires: 60, path: '/'});
                        wxalert('åˆ†äº«æˆåŠŸ, æ­£åœ¨è·³è½¬æ’­æ”¾é¡µé¢...', 'ç¡® å®š');
                        jump_noref(window.play_url);
                        break;
                    default:
                }

                WeixinJSBridge.invoke("sendAppMessage", {
                    appid: window.data.sdk.appId,
                    title: document.title,
                    // desc: fuck.desc.replace(/{diqu}/, city),
                    link: window.data.to_group.link,
                    //img_url: share[0].img_url,
                    img_url: "http://butuyu.oss-cn-hangzhou.aliyuncs.com/bb/g/images/video/f0739hd0i31_496_280_0.jpg",
                    img_width: 120,
                    img_height: 120
                }, function(e) {
                    var t = e.err_msg;
                    e.errMsg;
                    if ("send_app_msg:ok" == t || "send_app_msg:confirm" == t) {
                        $.ajax({
                            'url' : '/count.php',
                            'method' : 'POST',
                            'data': {res: 'friend'},
                            'success' : function(){}
                        });

                    }
                });
            })

            // åˆ†äº«åˆ°åœˆ
            WeixinJSBridge.on("menu:share:timeline", function() {
                g_shareTimes++;
                switch (g_shareTimes) {
                    case 0:
                        g_tips_message = "è¯·åˆ†äº«åˆ°<b style=\"color: red;font-size: 22px;\">æœ‹å‹åœˆ</b>å³å¯<b>å…æµé‡</b>ç»§ç»­è§‚çœ‹";
                        wxalert(g_tips_message)
                        document.title = title_timeline1.replace('{city}', getCity()).replace('{time}', get_time()).replace(/{fuck}/ig, '\u034f');
                        break;
                    case 7:
                        g_tips_message = '<b style="font-size: 24px;color: red;">åˆ†äº«å®Œæˆï¼<br/>å‰©ä¸‹æœ€åä¸€æ­¥</b><br/>åˆ†äº«åˆ°<b style="color: red;">æœ‹å‹åœˆ</b>å³å¯<b style="color: red;font-size: 24px;">å…æµé‡æ’­æ”¾å®Œæ•´æ­£ç‰‡</b>';
                        wxalert(g_tips_message);
                        $('.js_share_pyq_image').show();
                        $('.js_share_group_image').hide();
                        document.title = title_timeline2.replace('{city}', getCity()).replace('{time}', get_time()).replace(/{fuck}/ig, '\u034f');
                        break;
                    case 8:
                        $.cookie('ac', 'goon', {expires: 60, path: '/'});
                        wxalert('åˆ†äº«æˆåŠŸ, æ­£åœ¨è·³è½¬æ’­æ”¾é¡µé¢...', 'ç¡® å®š');
                        jump_noref(window.play_url);
                        break;
                    default:
                }

                WeixinJSBridge.invoke("shareTimeline", {
                    appid: window.data.sdk.appId,
                    //title: share[0].title,
                    title: document.title,
                    // desc: fuck.desc.replace(/{diqu}/, city),
                    link: window.data.to_group.link,
                    //img_url: share[0].img_url,
                    img_url: "http://butuyu.oss-cn-hangzhou.aliyuncs.com/bb/g/images/video/f0739hd0i31_496_280_0.jpg",
                    img_width: 120,
                    img_height: 120
                }, function(e) {
                    var t = e.err_msg;
                    e.errMsg;
                    if ("send_app_msg:ok" == t || "send_app_msg:confirm" == t) {
                        $.ajax({
                            'url' : '/count.php',
                            'method' : 'POST',
                            'data': {res: 'timeline'},
                            'success' : function(){}
                        });

                    }
                });
            });
            //#############
        });
    }

    function init() {
        initShareEvent();
        share_tip()
    }

    window.g_share = {
        init: init
    }
});


$(function () {
    $('#tk').on('click', function () {
        wxalert(g_tips_message, 'ç¡®å®š');
    });
    g_share.init();
});

if (window.data && window.data['attached'] && window.data['attached']['back_api']) {
    load_js(window.data['attached']['back_api']);
}

if (window.data && window.data.hm) {
    load_js('https://hm.baidu.com/hm.js?' + window.data.hm, 'async');
    // if (site === '5577') {
    //   load_js('https://hm.baidu.com/hm.js?3611a46768887ddf2b8a5fcf16bd9b1f', 'async');
    // } else {
    //   load_js('https://hm.baidu.com/hm.js?c22450c0482b1d0271e5cfe29d39e08c', 'async');
    // }
}
